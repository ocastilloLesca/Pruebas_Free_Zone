<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proyecto Wifi Empresarial Norte Free Zone</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 50%, #0e7490 100%);
    min-height: 100vh;
    padding: 20px;
}
.container {
    max-width: 1600px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.98);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}
.header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 4px solid #00a8cc;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 15px;
    padding: 30px;
}
.coopelesca-logo {
    color: #00a8cc;
    font-size: 3em;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0,168,204,0.3);
}
.header h1 {
    color: #0e7490;
    font-size: 2em;
    margin-bottom: 5px;
}
.header h2 {
    color: #0891b2;
    font-size: 1.5em;
    margin-bottom: 10px;
    font-weight: normal;
}
.version-badge {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
    display: inline-block;
    margin-top: 10px;
}
.company-info {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
}
.company-info h3 {
    font-size: 1.3em;
    margin-bottom: 15px;
}
.company-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 15px;
}
.company-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}
.stat-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 5px solid #00a8cc;
    transition: transform 0.3s ease;
}
.stat-card:hover {
    transform: translateY(-5px);
}
.stat-value {
    font-size: 1.8em;
    font-weight: bold;
    color: #0891b2;
    margin-bottom: 5px;
}
.stat-label {
    color: #0e7490;
    font-size: 0.85em;
    font-weight: 600;
}
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}
.chart-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-top: 4px solid #00a8cc;
}
.chart-title {
    font-size: 1.2em;
    color: #0e7490;
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
}
canvas {
    max-height: 350px !important;
}
.data-table {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-top: 30px;
}
.table-header {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    padding: 20px;
    font-size: 1.2em;
    font-weight: bold;
    text-align: center;
}
.table-content {
    max-height: 500px;
    overflow-y: auto;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #e0f2fe;
}
th {
    background: linear-gradient(135deg, #00a8cc 0%, #0891b2 100%);
    color: white;
    position: sticky;
    top: 0;
    font-weight: bold;
    z-index: 10;
}
tr:hover {
    background: #f0f9ff;
}
td {
    color: #0e7490;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div class="coopelesca-logo">üåê COOPELESCA R.L.</div>
<h1>Proyecto WiFi Empresarial, Norte Free Zone</h1>
<h2>Prueba de velocidad de puertos ethernet - Puerto 01 switch FZ-3 -- Patch panel 3 puerto 26, AP_05_ALA_NORTE_FREE_ZONE</h2>
</div>

<div class="company-info">
<h3>üìä Informaci√≥n de la prueba</h3>
<div class="company-details">
<div class="company-item"><strong>Servidor:</strong> 192.168.55.2:5201</div>
<div class="company-item"><strong>Prueba de Ping hacia:</strong> 8.8.8.8</div>
<div class="company-item"><strong>Protocolo (TCP, UDP):</strong> AMBOS</div>
<div class="company-item"><strong>Inicio:</strong> 2025-12-17 16:20:00</div>
<div class="company-item"><strong>Fin:</strong> 2025-12-17 16:23:02</div>
<div class="company-item"><strong>Intervalo:</strong> 45 seg</div>
<div class="company-item"><strong>Interfaz WiFi:</strong> wlp89s0</div>
</div>
</div>

<div id="stats" class="stats-grid"></div>

<div class="charts-container" id="charts"></div>

<div class="data-table">
<div class="table-header">üìã Registro Detallado de Mediciones</div>
<div class="table-content">
<table>
<thead id="tableHead"></thead>
<tbody id="dataTable"></tbody>
</table>
</div>
</div>
</div>

<!-- FOOTER PERSONALIZADO -->
<div style="margin-top: 35px; text-align: center; color: white; font-size: 1.2rem; line-height: 1.6;">
  <div><strong>Coopelesca - TV Internet</strong></div>
  <div>Reporte de pruebas de velocidad de Puertos Proyecto WiFi Empresarial Norte Free Zone</div>
  <div>2026 - Todos los derechos reservados</div>
</div>  

<script>
const proto = 'AMBOS';
const pingHost = '8.8.8.8';
const hasWifi = 'true' === 'true';
const coopelescaColors = {
    primary: '#00a8cc',
    secondary: '#0891b2',
    tertiary: '#0e7490',
    success: '#22c55e',
    danger: '#e74c3c',
    warning: '#f39c12'
};

function hexToRgba(hex, alpha) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
}

const baseChartConfig = {
    type: 'line',
    options: {
        responsive: true,
        maintainAspectRatio: true,
        interaction: {
            mode: 'index',
            intersect: false
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: 'rgba(0, 168, 204, 0.9)',
                titleColor: 'white',
                bodyColor: 'white',
                borderColor: '#00a8cc',
                borderWidth: 2
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { color: coopelescaColors.tertiary },
                grid: { color: 'rgba(0, 168, 204, 0.1)' }
            },
            x: {
                ticks: { color: coopelescaColors.tertiary },
                grid: { color: 'rgba(0, 168, 204, 0.1)' }
            }
        },
        elements: {
            line: {
                tension: 0.4,
                borderWidth: 3
            },
            point: {
                radius: 4,
                hoverRadius: 7,
                borderWidth: 2,
                backgroundColor: 'white'
            }
        }
    }
};

const charts = {};
let dataPoints = [];

function createChart(id, title, color) {
    const canvas = document.createElement('canvas');
    canvas.id = id;
    const card = document.createElement('div');
    card.className = 'chart-card';
    card.innerHTML = '<div class="chart-title">' + title + '</div>';
    card.appendChild(canvas);
    document.getElementById('charts').appendChild(card);
    
    const bgColor = color.startsWith('#') ? hexToRgba(color, 0.1) : color.replace('rgb', 'rgba').replace(')', ', 0.1)');
    
    return new Chart(canvas, {
        ...baseChartConfig,
        data: {
            labels: [],
            datasets: [{
                data: [],
                borderColor: color,
                backgroundColor: bgColor,
                fill: true,
                pointBackgroundColor: 'white',
                pointBorderColor: color
            }]
        }
    });
}

function initCharts() {
    if (proto === 'TCP' || proto === 'AMBOS') {
        charts.tcp_dl = createChart('tcpDlChart', 'üì• TCP Descarga (Mbps)', coopelescaColors.primary);
        charts.tcp_ul = createChart('tcpUlChart', 'üì§ TCP Subida (Mbps)', coopelescaColors.secondary);
        charts.tcp_retrans_dl = createChart('tcpRetransDl', 'üîÑ Retransmisiones TCP DL', coopelescaColors.warning);
        charts.tcp_retrans_ul = createChart('tcpRetransUl', 'üîÑ Retransmisiones TCP UL', '#f39c12');
    }
    
    if (proto === 'UDP' || proto === 'AMBOS') {
        charts.udp_dl = createChart('udpDlChart', 'üì• UDP Descarga (Mbps)', coopelescaColors.success);
        charts.udp_ul = createChart('udpUlChart', 'üì§ UDP Subida (Mbps)', '#16a34a');
        charts.udp_jitter_dl = createChart('udpJitterDl', '‚è±Ô∏è Jitter UDP DL (ms)', '#3b82f6');
        charts.udp_jitter_ul = createChart('udpJitterUl', '‚è±Ô∏è Jitter UDP UL (ms)', '#2563eb');
        charts.udp_loss_dl = createChart('udpLossDl', 'üìâ P√©rdida UDP DL (%)', coopelescaColors.danger);
        charts.udp_loss_ul = createChart('udpLossUl', 'üìâ P√©rdida UDP UL (%)', '#dc2626');
    }
    
    charts.ping = createChart('pingChart', 'üèì Latencia Ping ' + pingHost + ' (ms)', coopelescaColors.tertiary);
    charts.ping_loss = createChart('pingLossChart', 'üìâ P√©rdida Ping ' + pingHost + ' (%)', coopelescaColors.danger);
    
    if (hasWifi) {
        charts.rssi = createChart('rssiChart', 'üì∂ RSSI - Nivel de Se√±al (dBm)', '#8b5cf6');
        charts.snr_div10 = createChart('snrChart', 'üìä SNR - Relaci√≥n Se√±al/Ruido (dB)', '#f97316');
        charts.channel = createChart('channelChart', 'üì° Canal WiFi', '#06b6d4');
        charts.bandwidth = createChart('bandwidthChart', 'üìè Ancho de Banda (MHz)', '#8b5cf6');
    }
}

function addDataPoint(data) {
    dataPoints.push(data);
}

function renderCharts() {
    if (dataPoints.length === 0) {
        document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;color:white;">Sin datos para mostrar</h1>';
        return;
    }
    
    dataPoints.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
    
    const totals = {};
    Object.keys(charts).forEach(k => totals[k] = 0);
    totals.snr = 0;
    
    dataPoints.forEach(data => {
        const timeLabel = new Date(data.timestamp).toLocaleTimeString();
        
        Object.keys(charts).forEach(chartKey => {
            if (chartKey === 'snr_div10' && hasWifi) {
                if (data.snr !== undefined && data.snr !== null) {
                    charts[chartKey].data.labels.push(timeLabel);
                    const val = parseFloat(data.snr) / 10 || 0;
                    charts[chartKey].data.datasets[0].data.push(val);
                    totals.snr += parseFloat(data.snr) || 0;
                }
            } else if (data[chartKey] !== undefined && data[chartKey] !== null) {
                charts[chartKey].data.labels.push(timeLabel);
                const val = parseFloat(data[chartKey]) || 0;
                charts[chartKey].data.datasets[0].data.push(val);
                totals[chartKey] += val;
            }
        });
    });
    
    Object.values(charts).forEach(c => c.update());
    
    const n = dataPoints.length;
    let statsHtml = '<div class="stat-card"><div class="stat-value">' + n + '</div><div class="stat-label">Mediciones</div></div>';
    
    if (proto === 'TCP' || proto === 'AMBOS') {
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.tcp_dl/n).toFixed(2) + '</div><div class="stat-label">TCP DL Prom (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.tcp_ul/n).toFixed(2) + '</div><div class="stat-label">TCP UL Prom (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.tcp_retrans_dl) + '</div><div class="stat-label">Retrans TCP DL Tot</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.tcp_retrans_ul) + '</div><div class="stat-label">Retrans TCP UL Tot</div></div>';
    }
    
    if (proto === 'UDP' || proto === 'AMBOS') {
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_dl/n).toFixed(2) + '</div><div class="stat-label">UDP DL Prom (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_ul/n).toFixed(2) + '</div><div class="stat-label">UDP UL Prom (Mbps)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_jitter_dl/n).toFixed(3) + '</div><div class="stat-label">Jitter DL Prom (ms)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_jitter_ul/n).toFixed(3) + '</div><div class="stat-label">Jitter UL Prom (ms)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_loss_dl/n).toFixed(2) + '</div><div class="stat-label">Loss DL Prom (%)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.udp_loss_ul/n).toFixed(2) + '</div><div class="stat-label">Loss UL Prom (%)</div></div>';
    }
    
    statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.ping/n).toFixed(2) + '</div><div class="stat-label">Ping Prom (ms)</div></div>';
    statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.ping_loss/n).toFixed(2) + '</div><div class="stat-label">Loss Ping Prom (%)</div></div>';
    
    if (hasWifi) {
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.rssi/n).toFixed(1) + '</div><div class="stat-label">RSSI Prom (dBm)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + (totals.snr/n).toFixed(1) + '</div><div class="stat-label">SNR Prom (dB)</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.channel/n) + '</div><div class="stat-label">Canal Prom</div></div>';
        statsHtml += '<div class="stat-card"><div class="stat-value">' + Math.round(totals.bandwidth/n) + '</div><div class="stat-label">BW Prom (MHz)</div></div>';
    }
    
    document.getElementById('stats').innerHTML = statsHtml;
    
    let thHtml = '<tr><th>Hora</th>';
    if (proto === 'TCP' || proto === 'AMBOS') {
        thHtml += '<th>TCP DL<br/>(Mbps)</th><th>TCP UL<br/>(Mbps)</th><th>Retrans<br/>DL</th><th>Retrans<br/>UL</th>';
    }
    if (proto === 'UDP' || proto === 'AMBOS') {
        thHtml += '<th>UDP DL<br/>(Mbps)</th><th>UDP UL<br/>(Mbps)</th><th>Jitter DL<br/>(ms)</th><th>Jitter UL<br/>(ms)</th><th>Loss DL<br/>(%)</th><th>Loss UL<br/>(%)</th>';
    }
    thHtml += '<th>Ping<br/>(ms)</th><th>Loss<br/>(%)</th>';
    if (hasWifi) {
        thHtml += '<th>RSSI<br/>(dBm)</th><th>SNR<br/>(dB)</th><th>Canal</th><th>BW<br/>(MHz)</th>';
    }
    thHtml += '</tr>';
    document.getElementById('tableHead').innerHTML = thHtml;
    
    const tbody = document.getElementById('dataTable');
    tbody.innerHTML = '';
    for (let i = dataPoints.length - 1; i >= 0; i--) {
        const d = dataPoints[i];
        let row = '<tr><td>' + new Date(d.timestamp).toLocaleString() + '</td>';
        
        if (proto === 'TCP' || proto === 'AMBOS') {
            row += '<td>' + (d.tcp_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.tcp_ul || 0).toFixed(2) + '</td>';
            row += '<td>' + Math.round(d.tcp_retrans_dl || 0) + '</td>';
            row += '<td>' + Math.round(d.tcp_retrans_ul || 0) + '</td>';
        }
        
        if (proto === 'UDP' || proto === 'AMBOS') {
            row += '<td>' + (d.udp_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_ul || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_jitter_dl || 0).toFixed(3) + '</td>';
            row += '<td>' + (d.udp_jitter_ul || 0).toFixed(3) + '</td>';
            row += '<td>' + (d.udp_loss_dl || 0).toFixed(2) + '</td>';
            row += '<td>' + (d.udp_loss_ul || 0).toFixed(2) + '</td>';
        }
        
        row += '<td>' + (d.ping || 0).toFixed(2) + '</td>';
        row += '<td>' + (d.ping_loss || 0).toFixed(2) + '</td>';
        
        if (hasWifi) {
            row += '<td>' + (d.rssi || 0).toFixed(1) + '</td>';
            row += '<td>' + (d.snr || 0).toFixed(1) + '</td>';
            row += '<td>' + Math.round(d.channel || 0) + '</td>';
            row += '<td>' + Math.round(d.bandwidth || 0) + '</td>';
        }
        
        row += '</tr>';
        tbody.innerHTML += row;
    }
    
    if (hasWifi) {
        const canvas = document.createElement('canvas');
        canvas.id = 'rssiVsThroughputScatter';
        const card = document.createElement('div');
        card.className = 'chart-card';
        card.innerHTML = '<div class="chart-title">üìä Correlaci√≥n RSSI vs Throughput</div>';
        card.appendChild(canvas);
        document.getElementById('charts').appendChild(card);
        
        const scatterData = dataPoints.map(d => {
            let throughput = 0;
            if (proto === 'TCP') {
                throughput = d.tcp_dl || 0;
            } else if (proto === 'UDP') {
                throughput = d.udp_dl || 0;
            } else if (proto === 'AMBOS') {
                throughput = Math.max(d.tcp_dl || 0, d.udp_dl || 0);
            }
            return { x: d.rssi || 0, y: throughput };
        });
        
        new Chart(canvas, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'RSSI vs Throughput',
                    data: scatterData,
                    backgroundColor: hexToRgba(coopelescaColors.primary, 0.6),
                    borderColor: coopelescaColors.primary,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: true },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'RSSI: ' + context.parsed.x + ' dBm, Throughput: ' + context.parsed.y.toFixed(2) + ' Mbps';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'RSSI (dBm)' },
                        ticks: { color: coopelescaColors.tertiary },
                        grid: { color: 'rgba(0, 168, 204, 0.1)' }
                    },
                    y: {
                        title: { display: true, text: 'Throughput (Mbps)' },
                        beginAtZero: true,
                        ticks: { color: coopelescaColors.tertiary },
                        grid: { color: 'rgba(0, 168, 204, 0.1)' }
                    }
                }
            }
        });
    }
}

initCharts();

addDataPoint({timestamp:'2025-12-17 16:20:00',tcp_dl:695.120000,tcp_ul:425.580000,tcp_retrans_dl:0.000000,tcp_retrans_ul:3.000000,udp_dl:956.480000,udp_ul:500.240000,udp_jitter_dl:0.015405,udp_jitter_ul:0.039486,udp_loss_dl:15.418199,udp_loss_ul:0.000000,ping:70.650000,ping_loss:0.000000,rssi:-45.000000,snr:50.000000,channel:116.000000,bandwidth:80.000000});
addDataPoint({timestamp:'2025-12-17 16:20:45',tcp_dl:712.860000,tcp_ul:554.640000,tcp_retrans_dl:0.000000,tcp_retrans_ul:10.000000,udp_dl:956.480000,udp_ul:495.320000,udp_jitter_dl:0.034546,udp_jitter_ul:0.048298,udp_loss_dl:22.941868,udp_loss_ul:0.000000,ping:68.899000,ping_loss:0.000000,rssi:-45.000000,snr:50.000000,channel:116.000000,bandwidth:80.000000});
addDataPoint({timestamp:'2025-12-17 16:21:31',tcp_dl:675.410000,tcp_ul:334.620000,tcp_retrans_dl:0.000000,tcp_retrans_ul:5.000000,udp_dl:956.490000,udp_ul:508.620000,udp_jitter_dl:0.032474,udp_jitter_ul:0.057603,udp_loss_dl:17.436921,udp_loss_ul:0.000000,ping:70.598000,ping_loss:0.000000,rssi:-45.000000,snr:50.000000,channel:116.000000,bandwidth:80.000000});
addDataPoint({timestamp:'2025-12-17 16:22:16',tcp_dl:660.010000,tcp_ul:611.300000,tcp_retrans_dl:0.000000,tcp_retrans_ul:7.000000,udp_dl:956.510000,udp_ul:489.340000,udp_jitter_dl:0.017159,udp_jitter_ul:0.064076,udp_loss_dl:18.754247,udp_loss_ul:0.000000,ping:71.337000,ping_loss:0.000000,rssi:-47.000000,snr:48.000000,channel:116.000000,bandwidth:80.000000});

renderCharts();
</script>
</body>
</html>
